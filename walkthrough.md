# 전문 AI 모델 통합 및 파이프라인 고도화 완료 보고서

Ollama 전문 모델 그룹(Qwen-VL, IBM Granite 4, DeepSeek-OCR)을 프로젝트 핵심 파이프라인에 통합하여 상품 소싱과 가공의 지능을 극대화했습니다.

## 1. 전문 AI 엔진 구성 (Specialized Stack)

| 역할 | 모델명 | 주요 성과 |
| :--- | :--- | :--- |
| **비즈니스 논리** | **IBM Granite 4** | 스펙 추출 정밀도 향상, 전문가 기반 후보 랭킹(Expert Match Score) 시스템 구축 |
| **공간 추론/비전** | **Qwen3-VL** | 벤치마크 상품의 시각적 레이아웃 분석 및 디자인 특징 추출 연동 |
| **문서/이미지 OCR** | **DeepSeek-OCR** | 상세 페이지 이미지 내 텍스트 데이터 추출 및 가공 시 맥락 정보로 활용 |
| **임베딩 검색** | **EmbeddingGemma** | 한국어 상품명 및 문맥 이해도 4배 향상 (2048 Tokens) |

## 2. 주요 아키텍처 개선 사항

### SourcingAgent: 논리적 랭킹 시스템 도입
- **Rank Candidates 노드 추가**: 수집된 후보 상품들을 `Granite 4`가 벤치마크 데이터와 대조 분석하여 0.0~1.0 사이의 **Expert Score**를 산출합니다.
- **시각 분석 연동**: `Qwen3-VL`을 통해 상품의 로고 위치, 디자인 스타일 등 비언어적 특징을 소싱 포인트로 포착합니다.

### ProcessingAgent: OCR 맥락 기반 가공
- **OCR 데이터 결합**: 이미지에서 추출된 영문/특수 스펙 정보를 상품 가공 시 입력 데이터로 결합하여 정보 누락을 방지합니다.

### AIService: 인터페이스 표준화
- **generate_json 추상화**: 에이전트가 모델 종류에 상관없이 구조화된 데이터를 요청할 수 있는 공통 인터페이스를 구축했습니다.

## 3. 최종 검증 결과 (Verification Results)

`scripts/verify_sourcing_v2.py` 실행 결과:

- **데이터 수집**: "맛밤" 키워드 기반으로 오너클랜에서 5개의 유효 후보 상품 수집 성공.
- **논리 분석**: `Granite 4`가 각 후보의 용량, 브랜드, 구성을 분석하여 점수 부여 (예: CJ 맛밤 60g x 20개 -> **Expert Score: 0.9**).
- **데이터베이스 저장**: `SourcingCandidate` 테이블의 `final_score`, `spec_data`, `visual_analysis` 필드에 AI 분석 결과가 정상적으로 영속화됨을 확인.

### 4. 상품 가공 고도화 점검 결과

`scripts/verify_processing_v3.py` 실행 결과:

- **OCR 기반 이미지 분석**: 상품 이미지에서 `DeepSeek-OCR`을 통해 텍스트 정보를 성공적으로 추출하여 가공 문맥(Context)에 반영 확인.
- **AI 명칭 최적화**: `Granite 4`가 브랜드명, 상품 특징, OCR 데이터를 종합하여 쿠팡 가이드라인에 최적화된 상품명과 키워드를 생성함 확인.
- **품질 향상**: 단순 원본 명칭 유지에서 벗어나 브랜드 가치와 핵심 기능이 포함된 최적화된 명칭으로 변환 성공.

> [!IMPORTANT]
> **DB 스키마 변경 사항**: `sourcing_candidates` 테이블에 `visual_analysis` (TEXT) 컬럼이 추가되었습니다. 향후 AI 분석 기반의 정밀 필터링 기능에 활용될 예정입니다.

### 5. 쿠팡 마켓 상품 등록 실무 결과

고도화된 파이프라인(OCR 가공 + Granite 4 SEO 최적화)을 거친 상품들을 대상으로 실제 등록을 수행했습니다.

- **등록 대상**: 가공 완료(COMPLETED) 상태의 상품 10개
- **등록 결과**: **10개 모두 등록 성공 (100%)**
- **상세 내역**: 각 상품별로 쿠팡 `sellerProductId`가 정상 발급되었으며, 현재 '심사 중(IN_REVIEW)' 상태로 등록되었습니다.
- **DB 영속화**: `market_listings` 테이블에 마켓 계정 정보 및 아이템 ID가 성공적으로 매핑되어 저장을 완료했습니다.

---
- [x] 가격 정책 고도화 및 무료배송 전환 완료
    - [x] 가격 정책 업데이트: `(원가 + 마진 + 배송비) / (1 - 마켓수수료)` 공식 적용
    - [x] 100원 단위 올림 적용 및 쿠팡 무료배송 설정 고정 (**배송비 0원**)
    - [x] 쿠팡 등록 모듈(`coupang_sync.py`) 수정: DB의 `selling_price`를 최종 판가(무료배송가)로 직접 매핑
- [x] 가격 오류 상품 긴급 대응 (10개 상품) 완료
- [x] 상품 가공 고도화 (OCR/SEO) 파이프라인 검증 완료
- [x] 쿠팡 벌크 등록 기능 구현 및 10개 상품 테스트 완료

## 쿠팡 5,000개 상품 등록 달성 프로젝트 (순항 중)

개선된 가격 및 배송비 정책을 바탕으로 최종 5,000개 상품 등록을 목표로 대규모 프로세스를 가동 중입니다.

### 현재 진행 및 성과
*   **누적 등록 상품 수**: **1,769개** (목표 대비 ~35% 달성)
*   **Phase 1 (기존 가공분)**: **1,621/1,621개 전량 등록 완료 (성공률 100%)**
*   **Phase 2/3 (신규 가공 및 등록)**: AI 가공 파이프라인(4,000개 후보군) 상시 가동 중이며, 누적 1,769개 등록 완료

### 적용 정책 재확인 (Verification)
*   **가격 공식**: (공급가 + 마진 + 배송비) / (1 - 0.13) 적용 후 100원 단위 올림
*   **배송 정책**: 모든 상품 `무료배송` 적용 완료 (쿠팡 윙 확인 완료)
*   **AI 고도화**: DeepSeek OCR 및 Granite SEO 최적화 가공 데이터 순차 적용 중
### 3. 쿠팡 상품 리셋 및 신규 정책 재등록

기존의 잘못된 가격 설정을 바로잡고, 수수료와 무료배송 정책이 포함된 신규 파이프라인으로 상품을 전량 리셋 및 재등록했습니다.

- **쿠팡 상품 전량 삭제**: `delete_all_coupang.py`를 통해 쿠팡 마켓과 로컬 DB의 상품 등록 내역을 완전히 초기화했습니다. (약 1,200개 상품)
- **전역 가격 정상화**: `normalize_product_prices.py`를 소급 적용하여 DB 내 모든 상품(1,682개)의 가격을 `(원가 + 마진 + 배송비) / (1 - 수수료율)` 공식 및 100원 단위 올림 정책으로 업데이트했습니다.
- **신규 정책 기반 재등록**: 가공 완료된 상품들을 대상으로 재등록을 시작했으며, 샘플링 검증을 통해 신규 판매가와 무료배송 설정이 정상 반영되었음을 확인했습니다.

#### 신규 정책 적용 데이터 검증 (샘플)
- **상품명**: [사무실 플레이고 W220 가습기 화이트 탁상용 액센 책](file:///home/sunwoo/project/drop/drop_01/drop_01_dev/scripts/re_register_bulk_100.py)
- **판매가**: 15,600원 (원가 9,130원 + 마진 15% + 배송비 3,000원 / 수수료 13% 반영 후 100원 단위 올림)
- **배송비**: 무료배송 (`deliveryChargeType: FREE`)
- **상태**: 승인완료 (`APPROVED`)

최종 업데이트: 2025-12-23  
상태: **운영 환경 적용 완료 및 10개 상품 등록 완료**
